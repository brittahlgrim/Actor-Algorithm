package main.java.ActorAlgorithm;

/*
 * Most of the following code is taken from this Stack Overflow post:
 * http://stackoverflow.com/questions/4308554/simplest-way-to-read-json-from-a-url-in-java
 */
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.net.URL;
import java.nio.charset.Charset;

import javax.json.*;

import java.net.HttpURLConnection;
import javax.xml.bind.JAXBContext;
import javax.xml.bind.JAXBException;


public class APIService {
	static String apikey = "7d27ef57-ffa6-4140-8992-3a52dae6e68d";
	private static String search = "http://imdb.wemakesites.net/api/search?q=%s&api_key=%s";
	private static String getById = "http://imdb.wemakesites.net/api/%s&api_key=%s";

	public static JsonObject readJsonFromUrl(String url) throws IOException, JsonException {
		InputStream is = new URL(url).openStream();
		try {
			JsonReaderFactory factory = Json.createReaderFactory(null);
			JsonReader reader1 = factory.createReader(new InputStreamReader(is, Charset.forName("UTF-8")));
			JsonObject json = reader1.readObject();

			return json;
		} finally {
			is.close();
		}
	}

	public static JsonObject SearchAPIForString(String query) throws JsonException, IOException
	{
		String uri =String.format(search, query, apikey);
		JsonObject result = readJsonFromUrl(uri.toString());
		return result;
	}

	//	  public static void main(String[] args) throws IOException, JsonException {
	//	    JsonObject json = readJsonFromUrl("https://graph.facebook.com/19292868552");
	//	    System.out.println(json.toString());
	//	    System.out.println(json.get("id"));
	//	  }
	
	
//	
//
///*	private static Iterable<FilmographyDataObject> getActorFilmIds(String actorId) throws IOException, JAXBException
//	{
//		String uri ="http://imdb.wemakesites.net/api/" + actorId + "?api_key=" + apikey;
//
//		URL url = new URL(uri);
//		HttpURLConnection connection =
//		    (HttpURLConnection) url.openConnection();
//		connection.setRequestMethod("GET");
//		connection.setRequestProperty("Accept", "application/xml");
//
//		JAXBContext jc = JAXBContext.newInstance(FullSearchResult.class);
//		InputStream xml = connection.getInputStream();
//		main.java.ActorAlgorithm.SearchContracts.GetByIDResult.FullSearchResult actorByIdResult =
//		    (main.java.ActorAlgorithm.SearchContracts.GetByIDResult.FullSearchResult) jc.createUnmarshaller().unmarshal(xml);
//		
//		Iterable<FilmographyDataObject> result = actorByIdResult.Data.filmography;
//		connection.disconnect();
//		return result;
//	}*/
//	
//	//private static SearchResultItem searchActorByName(String name) throws IOException, JAXBException
//	private static Object searchActorByName(String name) throws IOException, JAXBException
//	{
//		String uri ="http://imdb.wemakesites.net/api/search?q=" + name + "&api_key=" + apikey;
//
//		URL url = new URL(uri);
//		HttpURLConnection connection =
//		    (HttpURLConnection) url.openConnection();
//		connection.setRequestMethod("GET");
//		connection.setRequestProperty("Accept", "application/xml");
//
//		JAXBContext jc = JAXBContext.newInstance(Object.class);//FullSearchResult.class);
//		InputStream xml = connection.getInputStream();
//		Object x = jc.createUnmarshaller().unmarshal(xml);
//		//FullSearchResult fullActorSearchResult =
//		  //  (FullSearchResult) jc.createUnmarshaller().unmarshal(xml);
//		
//		//SearchResultItem firstActorSearchResult = fullActorSearchResult.data.results.names.iterator().next();
//		
//		connection.disconnect();
//
//		return x;
//		
//		//return firstActorSearchResult;
//	}
}
